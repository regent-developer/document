# MyBatis的一级二级缓存

## 一级缓存（Local Cache）

### 1. 什么是MyBatis的一级缓存？
MyBatis的一级缓存是SqlSession级别的缓存，即同一个SqlSession中执行相同的查询语句，第一次查询后会将结果缓存起来，以后再次执行相同的查询语句时，直接从缓存中获取结果，而不再执行SQL语句。该缓存是默认启用的，不需要额外配置。

### 2. 一级缓存的工作原理？
当用户发起一个查询请求时，MyBatis首先会检查一级缓存中是否已经存在该查询的结果。如果存在，则直接从一级缓存中返回结果，否则会执行SQL语句，并将查询结果存入一级缓存中，然后返回结果。

### 3. 一级缓存的失效条件？ 
一级缓存失效的条件主要有以下几种：
- 当执行增删改操作时，MyBatis会清空一级缓存，因为这些操作会改变数据库中的数据，如果继续使用一级缓存可能会导致数据不一致。
- 当手动调用SqlSession的clearCache()方法时，会清空一级缓存。
- 当SqlSession关闭时，一级缓存也会被清空。

### 4. 如何开启一级缓存？
MyBatis的一级缓存默认是开启的，不需要进行额外的配置。如果需要关闭一级缓存，可以在MyBatis的配置文件中添加以下配置：
```xml
<setting name="localCacheScope" value="STATEMENT"/>
```
其中，value的值可以是STATEMENT或SESSION，分别表示一级缓存的作用范围是当前语句或当前会话。


## 二级缓存（Caching）

### 1. 什么是MyBatis的二级缓存？
MyBatis的二级缓存是mapper级别的缓存，即同一个mapper中执行相同的查询语句，第一次查询后会将结果缓存起来，以后再次执行相同的查询语句时，直接从缓存中获取结果，而不再执行SQL语句。

### 2. 二级缓存的工作原理？
当用户发起一个查询请求时，MyBatis首先会检查二级缓存中是否已经存在该查询的结果。如果存在，则直接从二级缓存中返回结果，否则会执行SQL语句，并将查询结果存入二级缓存中，然后返回结果。

### 3. 二级缓存的失效条件？ 
二级缓存失效的条件主要有以下几种：
- 当执行增删改操作时，MyBatis会清空二级缓存，因为这些操作会改变数据库中的数据，如果继续使用二级缓存可能会导致数据不一致。
- 每次 SqlSessionFactory 重建时，缓存会被清空。
- 显式地调用缓存清除命令，如 sqlSession.clearCache()，会清空二级缓存。

### 4. 如何开启二级缓存？
MyBatis的二级缓存默认是关闭的，需要通过配置文件进行开启。在MyBatis的配置文件中添加以下配置：
```xml
<setting name="cacheEnabled" value="true"/>
```